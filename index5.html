<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SV Stores | Official App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .amazon-yellow { background-color: #FFD814; border: 1px solid #FCD200; }
        .bg-amazon-dark { background-color: #232f3e; }
        .hide { display: none !important; }
        .mode-active { border-bottom: 4px solid #ea580c; color: #ea580c; background-color: #fff7ed; }
        /* Smooth scrolling & Sidebar transition */
        html { scroll-behavior: smooth; }
        body { -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        /* Drawer Animation */
        #side-drawer { transition: transform 0.3s ease-in-out; }
        .drawer-open { transform: translateX(0) !important; }
        .drawer-closed { transform: translateX(-100%); }
    </style>
</head>
<body class="bg-gray-100 font-sans h-screen flex flex-col overflow-hidden text-gray-800">

    <div id="login-view" class="fixed inset-0 bg-white z-[100] flex flex-col justify-center px-8">
        <div class="text-center mb-8">
            <h1 class="text-5xl font-black text-orange-600 italic tracking-tighter mb-2">SV STORES</h1>
            <p class="text-gray-500 font-medium">Please Login to Order</p>
        </div>
        <div class="border border-gray-200 p-6 rounded-xl shadow-lg bg-white space-y-4">
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Your Name</label>
                <input type="text" id="inpName" placeholder="Enter Full Name" class="w-full p-3 border rounded-lg bg-gray-50 focus:outline-orange-500 font-bold">
            </div>
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Mobile Number</label>
                <input type="tel" id="inpPhone" placeholder="10-digit Mobile Number" class="w-full p-3 border rounded-lg bg-gray-50 focus:outline-orange-500 font-bold">
            </div>
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Village / City</label>
                <input type="text" id="inpLoc" placeholder="Ex: Bhimavaram" class="w-full p-3 border rounded-lg bg-gray-50 focus:outline-orange-500 font-bold">
            </div>
            
            <button onclick="validateAndLogin()" class="w-full amazon-yellow py-4 rounded-lg shadow-md font-bold text-gray-900 text-lg hover:bg-yellow-400 transition mt-4">
                START SHOPPING <i class="fa-solid fa-arrow-right ml-2"></i>
            </button>
            <p id="login-error" class="text-red-500 text-xs text-center font-bold hide">Please fill all details correctly!</p>
        </div>
    </div>

    <div id="drawer-overlay" onclick="toggleDrawer()" class="fixed inset-0 bg-black/50 z-[60] hide backdrop-blur-sm"></div>
    <aside id="side-drawer" class="fixed top-0 left-0 h-full w-72 bg-white z-[70] shadow-2xl drawer-closed flex flex-col">
        <div class="bg-amazon-dark p-6 text-white relative">
            <button onclick="toggleDrawer()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            <div class="w-16 h-16 bg-white text-orange-600 rounded-full flex items-center justify-center text-2xl font-bold mb-3 shadow">
                <i class="fa-solid fa-user"></i>
            </div>
            <h2 id="drawer-name" class="text-xl font-bold">User Name</h2>
            <p id="drawer-phone" class="text-sm opacity-80">+91 XXXXX XXXXX</p>
            <p id="drawer-loc" class="text-xs text-orange-300 mt-1"><i class="fa-solid fa-location-dot"></i> <span>Location</span></p>
        </div>
        
        <div class="p-4 flex-1 overflow-y-auto">
            <h3 class="text-gray-400 text-xs font-bold uppercase mb-3 tracking-wider">Menu</h3>
            <ul class="space-y-2">
                <li onclick="toggleDrawer(); navTo('cart')" class="flex items-center gap-3 p-3 rounded-lg hover:bg-orange-50 cursor-pointer text-gray-700 font-medium">
                    <i class="fa-solid fa-cart-shopping text-orange-500"></i> My Cart
                </li>
                <li onclick="openWhatsAppHistory()" class="flex items-center gap-3 p-3 rounded-lg hover:bg-orange-50 cursor-pointer text-gray-700 font-medium">
                    <i class="fa-solid fa-clock-rotate-left text-blue-500"></i> Previous Orders
                </li>
                <li onclick="toggleDrawer()" class="flex items-center gap-3 p-3 rounded-lg hover:bg-orange-50 cursor-pointer text-gray-700 font-medium">
                    <i class="fa-brands fa-whatsapp text-green-500"></i> Chat with Support
                </li>
            </ul>

            <div class="mt-8 p-4 bg-gray-50 rounded-xl border border-gray-100">
                <h4 class="font-bold text-sm mb-2">Need Help?</h4>
                <p class="text-xs text-gray-500 mb-3">Contact Admin for any issues.</p>
                <a href="tel:9618622559" class="block text-center bg-gray-200 py-2 rounded text-xs font-bold">CALL 96186 22559</a>
            </div>
        </div>
        
        <button onclick="logout()" class="p-4 text-red-500 font-bold border-t text-sm hover:bg-red-50 text-left">
            <i class="fa-solid fa-power-off mr-2"></i> Logout
        </button>
    </aside>

    <header id="main-header" class="hide bg-white shadow-md z-50 flex-none pb-1 sticky top-0">
        <div class="bg-amazon-dark text-white p-3 flex justify-between items-center shadow">
            <div class="flex items-center gap-3">
                <button onclick="toggleDrawer()" class="text-white text-xl focus:outline-none">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <div class="flex flex-col">
                    <span class="font-black italic text-lg tracking-tighter leading-none">SV STORES</span>
                    <span id="header-user-loc" class="text-[10px] text-gray-300">Select Location</span>
                </div>
            </div>
            
            <div onclick="navTo('cart')" class="relative pr-2">
                <i class="fa-solid fa-cart-shopping text-xl"></i>
                <span id="header-cart-badge" class="hide absolute -top-1 -right-1 bg-orange-500 text-white text-[9px] font-bold w-4 h-4 flex items-center justify-center rounded-full">0</span>
            </div>
        </div>
        
        <div class="p-2 bg-amazon-dark pt-1 pb-3">
            <div class="relative">
                <input type="text" id="searchBar" onkeyup="filterProducts()" placeholder="Search items..." class="w-full p-2.5 rounded text-black outline-none shadow-inner pl-10">
                <i class="fa-solid fa-magnifying-glass absolute left-3 top-3 text-gray-400"></i>
            </div>
        </div>

        <div class="flex bg-white border-b shadow-sm">
            <button onclick="switchMode('broom')" id="btn-broom" class="flex-1 py-3 flex flex-col items-center justify-center mode-active transition-all">
                <span class="text-xl">üßπ</span>
                <span class="text-[10px] font-black tracking-wide mt-1">BROOM FACTORY</span>
            </button>
            <div class="w-[1px] bg-gray-200"></div>
            <button onclick="switchMode('general')" id="btn-general" class="flex-1 py-3 flex flex-col items-center justify-center text-gray-400 transition-all">
                <span class="text-xl">üè†</span>
                <span class="text-[10px] font-black tracking-wide mt-1">GENERAL STORE</span>
            </button>
        </div>
    </header>

    <main id="content-area" class="hide flex-1 overflow-y-auto pb-6 bg-gray-100 relative">
        <div id="home-view" class="p-2">
            <div id="banner-area" class="mb-4 rounded-lg overflow-hidden shadow relative h-40 bg-gray-200"></div>
            <div id="product-grid" class="grid grid-cols-2 gap-2 pb-20"></div>
        </div>

        <div id="cart-view" class="hide bg-gray-100 min-h-full p-3 pb-32">
            <div class="flex items-center gap-2 mb-4">
                <button onclick="navTo('home')" class="bg-white px-3 py-1 rounded shadow text-sm"><i class="fa-solid fa-arrow-left"></i> Back</button>
                <h2 class="text-xl font-bold">Your Cart</h2>
            </div>
            
            <div id="cart-list" class="space-y-3"></div>

            <div id="empty-cart" class="text-center mt-24 opacity-60">
                <i class="fa-solid fa-cart-shopping text-6xl text-gray-300 mb-4"></i>
                <p class="font-bold">Cart is empty</p>
                <button onclick="navTo('home')" class="mt-4 bg-orange-500 text-white px-6 py-2 rounded-full font-bold shadow text-sm">Shop Now</button>
            </div>
        </div>
    </main>

    <div id="checkout-bar" class="hide fixed bottom-0 left-0 w-full bg-white p-4 shadow-[0_-5px_20px_rgba(0,0,0,0.1)] z-50 rounded-t-2xl">
        <div class="flex justify-between items-center mb-3">
            <div>
                <p class="text-xs text-gray-500">Total Amount</p>
                <h3 id="total-price" class="text-2xl font-black text-gray-900">‚Çπ0</h3>
            </div>
            <div class="text-right">
                <p class="text-xs text-gray-500">Items</p>
                <h3 id="total-items-count" class="font-bold text-gray-900">0</h3>
            </div>
        </div>
        <button onclick="placeOrder()" class="w-full bg-[#25D366] hover:bg-[#128C7E] text-white py-3.5 rounded-xl font-bold shadow-lg flex justify-center items-center gap-2 text-lg animate-pulse">
            <i class="fa-brands fa-whatsapp text-2xl"></i> Send Order on WhatsApp
        </button>
    </div>

    <script>
        // --- CONFIG & STATE ---
        const WHATSAPP_NUMBER = "9618622559";
        let currentUser = { name: "", phone: "", loc: "" };
        let currentMode = "broom"; 
        let cart = [];

        // --- INIT: CHECK LOGIN ---
        window.onload = function() {
            const savedUser = localStorage.getItem('svUser');
            if(savedUser) {
                currentUser = JSON.parse(savedUser);
                enterApp(true);
            }
        };

        // --- DATA ---
        function getPlaceholder(name) {
            const colors = ['e2e8f0', 'fed7aa', 'bbf7d0', 'bfdbfe', 'ddd6fe', 'fbcfe8'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            return `https://placehold.co/300x300/${color}/475569?text=${encodeURIComponent(name.split(' ')[0])}`;
        }

        const broomItems = [
            { id: 1, name: "Polyking Sutli (Heavy)", price: 185, img: "https://images.unsplash.com/photo-1605881528191-68f38c78e3d3?w=300" },
            { id: 2, name: "Bansal Steel Wire 22G", price: 83, img: "https://images.unsplash.com/photo-1621259182978-fbf93132d53d?w=300" },
            { id: 3, name: "Zen Sutli (Soft White)", price: 140, img: "https://images.unsplash.com/photo-1515569067071-ec3b51335dd0?w=300" },
            { id: 4, name: "Zoom Red Elastic Rope", price: 95, img: "https://images.unsplash.com/photo-1558236714-d117513c16e7?w=300" },
            { id: 5, name: "Wonderfull Jumbo Roll", price: 420, img: "https://images.unsplash.com/photo-1544644181-1484b3fdfc62?w=300" },
            { id: 6, name: "Plastic Handles (12pc)", price: 150, img: "https://images.unsplash.com/photo-1584622650111-993a426fbf0a?w=300" },
            { id: 7, name: "Coconut Broom Sticks", price: 45, img: "https://images.unsplash.com/photo-1595475267029-79a613296d92?w=300" },
            { id: 8, name: "Binding Machine Hand", price: 1200, img: "https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=300" }
        ];

        const generalItemsRaw = [
            { n: "Premium Sugar", p: 42, k: "sugar" }, { n: "Jaggery (Bellam)", p: 60, k: "jaggery" },
            { n: "Toor Dal", p: 130, k: "lentils" }, { n: "Moong Dal", p: 110, k: "legumes" },
            { n: "Basmati Rice", p: 95, k: "rice" }, { n: "Sona Masoori Rice", p: 55, k: "grain" },
            { n: "Sunflower Oil", p: 140, k: "oil" }, { n: "Groundnut Oil", p: 180, k: "oil" },
            { n: "Red Chilli Powder", p: 250, k: "chilli" }, { n: "Turmeric Powder", p: 180, k: "turmeric" },
            { n: "Tata Salt", p: 24, k: "salt" }, { n: "Crystal Salt", p: 15, k: "salt" },
            { n: "Taj Mahal Tea", p: 320, k: "tea" }, { n: "Red Label Tea", p: 280, k: "tea" },
            { n: "Bru Instant Coffee", p: 350, k: "coffee" }, { n: "Nescafe Classic", p: 380, k: "coffee" },
            { n: "Maggi Noodles", p: 14, k: "noodles" }, { n: "Yippee Noodles", p: 12, k: "noodles" },
            { n: "Good Day Biscuits", p: 30, k: "cookies" }, { n: "Rin Detergent Bar", p: 10, k: "soap" }, 
            { n: "Surf Excel Powder", p: 120, k: "detergent" }, { n: "Vim Dishwash Bar", p: 20, k: "soap" },
            { n: "Colgate Paste", p: 85, k: "toothpaste" }, { n: "Lux Soap", p: 35, k: "soap" },
            { n: "Santoor Soap", p: 32, k: "soap" }, { n: "Clinic Plus Shampoo", p: 80, k: "shampoo" },
            { n: "Parachute Coconut Oil", p: 110, k: "oil" }, { n: "Wheat Flour (Atta)", p: 45, k: "wheat" },
            { n: "Maida Flour", p: 40, k: "flour" }, { n: "Bombay Rava", p: 42, k: "grain" }
        ];

        let generalItems = [];
        let gId = 100;
        generalItemsRaw.forEach(item => {
            generalItems.push({ id: gId++, name: item.n + " 1kg/1L", price: item.p, img: `https://source.unsplash.com/random/300x300/?${item.k}` });
            generalItems.push({ id: gId++, name: item.n + " 500g/ml", price: Math.floor(item.p / 1.9), img: `https://source.unsplash.com/random/300x301/?${item.k}` });
        });

        // --- AUTH & DRAWER FUNCTIONS ---
        function validateAndLogin() {
            const name = document.getElementById('inpName').value.trim();
            const phone = document.getElementById('inpPhone').value.trim();
            const loc = document.getElementById('inpLoc').value.trim();
            const err = document.getElementById('login-error');

            if(name.length < 3 || phone.length < 10 || loc.length < 3) {
                err.classList.remove('hide');
                return;
            }

            currentUser = { name, phone, loc };
            localStorage.setItem('svUser', JSON.stringify(currentUser));
            enterApp(false);
        }

        function enterApp(isAuto) {
            // Update UI with User Data
            document.getElementById('drawer-name').innerText = currentUser.name;
            document.getElementById('drawer-phone').innerText = "+91 " + currentUser.phone;
            document.getElementById('drawer-loc').innerHTML = `<i class="fa-solid fa-location-dot"></i> ${currentUser.loc}`;
            document.getElementById('header-user-loc').innerText = currentUser.loc;

            document.getElementById('login-view').classList.add('hide');
            document.getElementById('main-header').classList.remove('hide');
            document.getElementById('content-area').classList.remove('hide');
            switchMode('broom');
        }

        function toggleDrawer() {
            const drawer = document.getElementById('side-drawer');
            const overlay = document.getElementById('drawer-overlay');
            if(drawer.classList.contains('drawer-closed')) {
                drawer.classList.remove('drawer-closed');
                drawer.classList.add('drawer-open');
                overlay.classList.remove('hide');
            } else {
                drawer.classList.add('drawer-closed');
                drawer.classList.remove('drawer-open');
                overlay.classList.add('hide');
            }
        }

        function logout() {
            localStorage.removeItem('svUser');
            location.reload();
        }

        // --- APP LOGIC ---
        function switchMode(mode) {
            currentMode = mode;
            const btnBroom = document.getElementById('btn-broom');
            const btnGen = document.getElementById('btn-general');
            const banner = document.getElementById('banner-area');
            const search = document.getElementById('searchBar');

            if(mode === 'broom') {
                btnBroom.classList.add('mode-active'); btnGen.classList.remove('mode-active');
                search.placeholder = "Search Sutli, Wire...";
                banner.innerHTML = `<img src="https://images.unsplash.com/photo-1621259182978-fbf93132d53d?q=80&w=800" class="w-full h-full object-cover"><div class="absolute bottom-0 w-full bg-black/60 p-3 text-white"><p class="font-bold">üè≠ Broom Materials Factory</p></div>`;
                renderGrid(broomItems);
            } else {
                btnGen.classList.add('mode-active'); btnBroom.classList.remove('mode-active');
                search.placeholder = "Search Sugar, Soap...";
                banner.innerHTML = `<img src="https://images.unsplash.com/photo-1604719312566-b7cb837627fa?q=80&w=800" class="w-full h-full object-cover"><div class="absolute bottom-0 w-full bg-black/60 p-3 text-white"><p class="font-bold">ü•¶ General Store & Grocery</p></div>`;
                renderGrid(generalItems);
            }
        }

        function renderGrid(items) {
            document.getElementById('product-grid').innerHTML = items.map(p => `
                <div class="bg-white rounded-lg border border-gray-100 shadow-sm flex flex-col overflow-hidden h-60">
                    <div class="h-32 bg-gray-50 relative">
                        <img src="${p.img}" onerror="this.src='${getPlaceholder(p.name)}'" class="w-full h-full object-contain p-2 hover:scale-105 transition duration-300">
                    </div>
                    <div class="p-2 flex flex-col justify-between flex-1">
                        <p class="text-xs font-medium text-gray-800 line-clamp-2 h-8 leading-tight">${p.name}</p>
                        <div class="mt-2">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-bold">‚Çπ${p.price}</span>
                                <button onclick="addToCart(${p.id})" class="bg-orange-100 text-orange-600 w-8 h-8 rounded-full font-bold shadow-sm hover:bg-orange-500 hover:text-white transition">+</button>
                            </div>
                        </div>
                    </div>
                </div>`).join('');
        }

        function addToCart(id) {
            let item = broomItems.find(x => x.id === id) || generalItems.find(x => x.id === id);
            let existing = cart.find(x => x.id === id);
            if(existing) existing.qty++; else cart.push({...item, qty: 1});
            
            updateCartUI();
            if(navigator.vibrate) navigator.vibrate(50);
            
            // Show toast
            const btn = event.target;
            const originalText = btn.innerText;
            btn.innerText = "‚úì";
            btn.classList.add("bg-green-500", "text-white");
            setTimeout(() => {
                btn.innerText = originalText;
                btn.classList.remove("bg-green-500", "text-white");
            }, 500);
        }

        function updateCartUI() {
            const totalQty = cart.reduce((a,b) => a + b.qty, 0);
            const totalAmt = cart.reduce((a,b) => a + (b.qty * b.price), 0);
            
            // Header Badge
            const badge = document.getElementById('header-cart-badge');
            badge.innerText = totalQty;
            totalQty > 0 ? badge.classList.remove('hide') : badge.classList.add('hide');

            // Checkout Bar
            const bar = document.getElementById('checkout-bar');
            if(totalQty >        
            function placeOrder() {
            if(cart.length === 0) return;
            
            // Format Date (Date & Time add chesamu)
            const date = new Date().toLocaleString('en-IN');
            
            let msg = `üõí *NEW ORDER - SV STORES*\n`;
            msg += `üìÖ Date: ${date}\n`;
            msg += `üë§ Customer: *${currentUser.name}*\n`;
            msg += `üì± Mobile: ${currentUser.phone}\n`;
            msg += `üìç Location: ${currentUser.loc}\n`;
            msg += `----------------------------\n`;
            
            cart.forEach((i, idx) => {
                msg += `${idx+1}. ${i.name} x ${i.qty} = ‚Çπ${i.price * i.qty}\n`;
            });
            
            const total = cart.reduce((a,b) => a + (b.price*b.qty), 0);
            msg += `----------------------------\n`;
            msg += `üí∞ *GRAND TOTAL: ‚Çπ${total}*`;
            msg += `\n----------------------------\n`;
            msg += `Please confirm delivery!`;

            // WhatsApp Open Cheyadam
            const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
            window.open(url, '_blank');
        }

        function openWhatsAppHistory() {
             window.open(`https://wa.me/${WHATSAPP_NUMBER}`, '_blank');
        }
    </script>
</body>
</html>
