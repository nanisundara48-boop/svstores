<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SV Stores | Official App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .amazon-yellow { background-color: #FFD814; border: 1px solid #FCD200; }
        .bg-amazon-dark { background-color: #232f3e; }
        .hide { display: none !important; }
        .mode-active { border-bottom: 4px solid #ea580c; color: #ea580c; background-color: #fff7ed; }
        html { scroll-behavior: smooth; }
        body { -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        #side-drawer { transition: transform 0.3s ease-in-out; }
        .drawer-open { transform: translateX(0) !important; }
        .drawer-closed { transform: translateX(-100%); }
    </style>
</head>
<body class="bg-gray-100 font-sans h-screen flex flex-col overflow-hidden text-gray-800">

    <div id="login-view" class="fixed inset-0 bg-white z-[100] flex flex-col justify-center px-8">
        <div class="text-center mb-8">
            <h1 class="text-5xl font-black text-orange-600 italic tracking-tighter mb-2">SV STORES</h1>
            <p class="text-gray-500 font-medium">Please Login to Order</p>
        </div>
        <div class="border border-gray-200 p-6 rounded-xl shadow-lg bg-white space-y-4">
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Your Name</label>
                <input type="text" id="inpName" placeholder="Enter Full Name" class="w-full p-3 border rounded-lg bg-gray-50 focus:outline-orange-500 font-bold">
            </div>
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Mobile Number</label>
                <input type="tel" id="inpPhone" placeholder="10-digit Mobile Number" class="w-full p-3 border rounded-lg bg-gray-50 focus:outline-orange-500 font-bold">
            </div>
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Village / City</label>
                <input type="text" id="inpLoc" placeholder="Ex: Bhimavaram" class="w-full p-3 border rounded-lg bg-gray-50 focus:outline-orange-500 font-bold">
            </div>
            
            <button onclick="validateAndLogin()" class="w-full amazon-yellow py-4 rounded-lg shadow-md font-bold text-gray-900 text-lg hover:bg-yellow-400 transition mt-4">
                START SHOPPING <i class="fa-solid fa-arrow-right ml-2"></i>
            </button>
            <p id="login-error" class="text-red-500 text-xs text-center font-bold hide">Please fill all details correctly!</p>
        </div>
    </div>

    <div id="drawer-overlay" onclick="toggleDrawer()" class="fixed inset-0 bg-black/50 z-[60] hide backdrop-blur-sm"></div>
    <aside id="side-drawer" class="fixed top-0 left-0 h-full w-72 bg-white z-[70] shadow-2xl drawer-closed flex flex-col">
        <div class="bg-amazon-dark p-6 text-white relative">
            <button onclick="toggleDrawer()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            <div class="w-16 h-16 bg-white text-orange-600 rounded-full flex items-center justify-center text-2xl font-bold mb-3 shadow">
                <i class="fa-solid fa-user"></i>
            </div>
            <h2 id="drawer-name" class="text-xl font-bold">User Name</h2>
            <p id="drawer-phone" class="text-sm opacity-80">+91 XXXXX XXXXX</p>
            <p id="drawer-loc" class="text-xs text-orange-300 mt-1"><i class="fa-solid fa-location-dot"></i> <span>Location</span></p>
        </div>
        <div class="p-4 flex-1 overflow-y-auto">
            <ul class="space-y-2">
                <li onclick="toggleDrawer(); navTo('cart')" class="flex items-center gap-3 p-3 rounded-lg hover:bg-orange-50 cursor-pointer text-gray-700 font-medium border-b">
                    <i class="fa-solid fa-cart-shopping text-orange-500"></i> My Cart
                </li>
                <li onclick="openWhatsAppHistory()" class="flex items-center gap-3 p-3 rounded-lg hover:bg-orange-50 cursor-pointer text-gray-700 font-medium border-b">
                    <i class="fa-solid fa-clock-rotate-left text-blue-500"></i> Previous Orders
                </li>
            </ul>
        </div>
        <button onclick="logout()" class="p-4 text-red-500 font-bold border-t text-sm hover:bg-red-50 text-left">
            <i class="fa-solid fa-power-off mr-2"></i> Logout
        </button>
    </aside>

    <header id="main-header" class="hide bg-white shadow-md z-50 flex-none pb-1 sticky top-0">
        <div class="bg-amazon-dark text-white p-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <button onclick="toggleDrawer()" class="text-white text-xl"><i class="fa-solid fa-bars"></i></button>
                <div class="flex flex-col">
                    <span class="font-black italic text-lg tracking-tighter leading-none text-orange-500">SV STORES</span>
                    <span id="header-user-loc" class="text-[10px] text-gray-300">Location</span>
                </div>
            </div>
            <div onclick="navTo('cart')" class="relative pr-2">
                <i class="fa-solid fa-cart-shopping text-xl"></i>
                <span id="header-cart-badge" class="hide absolute -top-1 -right-1 bg-orange-500 text-white text-[9px] font-bold w-4 h-4 flex items-center justify-center rounded-full">0</span>
            </div>
        </div>
        <div class="p-2 bg-amazon-dark pt-1 pb-3">
            <div class="relative">
                <input type="text" id="searchBar" onkeyup="filterProducts()" placeholder="Search items..." class="w-full p-2.5 rounded text-black outline-none pl-10">
                <i class="fa-solid fa-magnifying-glass absolute left-3 top-3 text-gray-400"></i>
            </div>
        </div>
        <div class="flex bg-white border-b">
            <button onclick="switchMode('broom')" id="btn-broom" class="flex-1 py-3 flex flex-col items-center mode-active">
                <span class="text-xl">üßπ</span><span class="text-[10px] font-black mt-1 uppercase">Broom Factory</span>
            </button>
            <button onclick="switchMode('general')" id="btn-general" class="flex-1 py-3 flex flex-col items-center text-gray-400">
                <span class="text-xl">üè†</span><span class="text-[10px] font-black mt-1 uppercase">General Store</span>
            </button>
        </div>
    </header>

    <main id="content-area" class="hide flex-1 overflow-y-auto pb-6 bg-gray-100">
        <div id="home-view" class="p-2">
            <div id="banner-area" class="mb-4 rounded-lg overflow-hidden h-40 bg-gray-200"></div>
            <div id="product-grid" class="grid grid-cols-2 gap-2 pb-20"></div>
        </div>
        <div id="cart-view" class="hide p-3 pb-32">
            <h2 class="text-xl font-bold mb-4">Your Cart</h2>
            <div id="cart-list" class="space-y-3"></div>
            <div id="empty-cart" class="text-center mt-20 opacity-60">
                <i class="fa-solid fa-cart-shopping text-5xl mb-3"></i><p>Cart is empty</p>
            </div>
        </div>
    </main>

    <div id="checkout-bar" class="hide fixed bottom-0 left-0 w-full bg-white p-4 shadow-2xl z-50 rounded-t-2xl">
        <div class="flex justify-between items-center mb-3">
            <div><p class="text-xs text-gray-500">Total</p><h3 id="total-price" class="text-2xl font-black">‚Çπ0</h3></div>
            <div class="text-right"><p class="text-xs text-gray-500">Items</p><h3 id="total-items-count" class="font-bold">0</h3></div>
        </div>
        <button onclick="placeOrder()" class="w-full bg-[#25D366] text-white py-4 rounded-xl font-bold flex justify-center items-center gap-2">
            <i class="fa-brands fa-whatsapp text-2xl"></i> SEND ORDER
        </button>
    </div>

    <script>
        const WHATSAPP_NUMBER = "9618622559";
        let currentUser = { name: "", phone: "", loc: "" };
        let currentMode = "broom"; 
        let cart = [];

        window.onload = function() {
            const savedUser = localStorage.getItem('svUser');
            if(savedUser) {
                currentUser = JSON.parse(savedUser);
                enterApp();
            }
        };

        function validateAndLogin() {
            const name = document.getElementById('inpName').value.trim();
            const phone = document.getElementById('inpPhone').value.trim();
            const loc = document.getElementById('inpLoc').value.trim();
            if(name.length < 3 || phone.length < 10 || loc.length < 3) {
                document.getElementById('login-error').classList.remove('hide');
                return;
            }
            currentUser = { name, phone, loc };
            localStorage.setItem('svUser', JSON.stringify(currentUser));
            enterApp();
        }

        function enterApp() {
            document.getElementById('drawer-name').innerText = currentUser.name;
            document.getElementById('drawer-phone').innerText = "+91 " + currentUser.phone;
            document.getElementById('drawer-loc').innerText = currentUser.loc;
            document.getElementById('header-user-loc').innerText = currentUser.loc;
            document.getElementById('login-view').classList.add('hide');
            document.getElementById('main-header').classList.remove('hide');
            document.getElementById('content-area').classList.remove('hide');
            switchMode('broom');
        }

        function toggleDrawer() {
            const drawer = document.getElementById('side-drawer');
            const overlay = document.getElementById('drawer-overlay');
            drawer.classList.toggle('drawer-closed');
            drawer.classList.toggle('drawer-open');
            overlay.classList.toggle('hide');
        }

        function logout() { localStorage.removeItem('svUser'); location.reload(); }

        const broomItems = [
            { id: 1, name: "Polyking Sutli (Heavy)", price: 185, img: "https://images.unsplash.com/photo-1605881528191-68f38c78e3d3?w=300" },
            { id: 2, name: "Bansal Steel Wire 22G", price: 83, img: "https://images.unsplash.com/photo-1621259182978-fbf93132d53d?w=300" },
            { id: 3, name: "Zen Sutli (Soft)", price: 140, img: "https://images.unsplash.com/photo-1515569067071-ec3b51335dd0?w=300" },
            { id: 4, name: "Zoom Red Elastic Rope", price: 95, img: "https://images.unsplash.com/photo-1558236714-d117513c16e7?w=300" }
        ];

        const generalItems = [
            { id: 100, name: "Premium Sugar 1kg", price: 42, img: "https://images.unsplash.com/photo-1581448670546-44b40783fadb?w=300" },
            { id: 101, name: "Toor Dal 1kg", price: 130, img: "https://images.unsplash.com/photo-1585996853877-ad9aa5d33fcc?w=300" }
        ];

        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('btn-broom').className = mode==='broom'?'flex-1 py-3 flex flex-col items-center mode-active':'flex-1 py-3 flex flex-col items-center text-gray-400';
            document.getElementById('btn-general').className = mode==='general'?'flex-1 py-3 flex flex-col items-center mode-active':'flex-1 py-3 flex flex-col items-center text-gray-400';
            renderGrid(mode === 'broom' ? broomItems : generalItems);
        }

        function renderGrid(items) {
            document.getElementById('product-grid').innerHTML = items.map(p => `
                <div class="bg-white rounded-lg border p-2 flex flex-col shadow-sm">
                    <img src="${p.img}" class="h-24 object-contain mb-2">
                    <p class="text-xs font-bold h-8 line-clamp-2">${p.name}</p>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-sm font-bold">‚Çπ${p.price}</span>
                        <button onclick="addToCart(${p.id})" class="bg-orange-500 text-white px-3 py-1 rounded text-xs">+</button>
                    </div>
                </div>`).join('');
        }

        function addToCart(id) {
            let item = [...broomItems, ...generalItems].find(x => x.id === id);
            let ex = cart.find(x => x.id === id);
            if(ex) ex.qty++; else cart.push({...item, qty: 1});
            updateCartUI();
        }

        function updateCartUI() {
            const totalQty = cart.reduce((a,b) => a + b.qty, 0);
            const totalAmt = cart.reduce((a,b) => a + (b.qty * b.price), 0);
            document.getElementById('header-cart-badge').innerText = totalQty;
            totalQty > 0 ? document.getElementById('header-cart-badge').classList.remove('hide') : document.getElementById('header-cart-badge').classList.add('hide');
            document.getElementById('total-price').innerText = "‚Çπ" + totalAmt;
            document.getElementById('total-items-count').innerText = totalQty;
            if(totalQty > 0 && !document.getElementById('cart-view').classList.contains('hide')) {
                document.getElementById('checkout-bar').classList.remove('hide');
            } else {
                document.getElementById('checkout-bar').classList.add('hide');
            }
        }

        function navTo(page) {
            document.getElementById('home-view').classList.add('hide');
            document.getElementById('cart-view').classList.add('hide');
            document.getElementById(page + '-view').classList.remove('hide');
            if(page==='cart') renderCartPage();
            updateCartUI();
        }

        function renderCartPage() {
            const list = document.getElementById('cart-list');
            if(cart.length === 0) {
                list.innerHTML = ''; document.getElementById('empty-cart').classList.remove('hide');
                return;
            }
            document.getElementById('empty-cart').classList.add('hide');
            list.innerHTML = cart.map(i => `
                <div class="flex bg-white p-2 rounded border gap-3">
                    <div class="flex-1 font-bold text-sm">${i.name} x ${i.qty}</div>
                    <div class="text-orange-600 font-bold">‚Çπ${i.price * i.qty}</div>
                </div>`).join('');
        }

        function placeOrder() {
            let msg = `üõí *NEW ORDER - SV STORES*\nüë§ *${currentUser.name}*\nüì± ${currentUser.phone}\nüìç ${currentUser.loc}\n----------------------------\n`;
            cart.forEach(i => msg += `‚Ä¢ ${i.name} x ${i.qty} = ‚Çπ${i.price * i.qty}\n`);
            msg += `----------------------------\nüí∞ *TOTAL: ‚Çπ${cart.reduce((a,b) => a + (b.price*b.qty), 0)}*`;
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function openWhatsAppHistory() { window.open(`https://wa.me/${WHATSAPP_NUMBER}`, '_blank'); }
        function filterProducts() {}
    </script>
</body>
</html>
